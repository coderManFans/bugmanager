<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD iBatis Mapper 3.0 //EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.com.bugmanager.bugcontent.dao.BugContentDao">
    <insert id="addBugContentWithAnswer">
        insert into t_bugcontent (bug_reason,console_error,bug_code,has_solved)
         VALUES (#{bugContent.bugReason},#{bugContent.consoleError},#{bugContent.bugCode},#{bugContent.hasSolved})
    </insert>

    <insert id="addBugContentNoAnswer" >
        insert into t_bugcontent (bug_contentid,bug_reason,console_error,bug_code,has_solved,add_date,user_id)
         VALUES (#{bugContent.bugcontentid},#{bugContent.bugReason},#{bugContent.consoleError},#{bugContent.bugCode}
            ,#{bugContent.hasSolved},#{bugContent.upDate},#{bugContent.userId})
    </insert>


    <select id="getBugContentSize" resultType="int">
        select count(*) from t_bugcontent
    </select>

    <!--批量插入关联关系-->
    <insert id="addbug_type">
        insert into t_bug_type(bug_id,type_id) values
        <foreach collection="bugTypeArray" item="item" index="index" separator=",">
            (#{bugContentId},#{item})
        </foreach>
    </insert>

    <select id="getBugContentId" resultType="string">
        select bug_contentid from t_bugcontent  where bug_code = #{bugcode} and bug_reason = #{bugReason}
    </select>

    <insert id="addbug_tag">
        insert into t_bug_tag(bug_id,tag_id) values
        <foreach collection="tagIdArray" item="item" index="index" separator=",">
            (#{bugContentId},#{item})
        </foreach>
    </insert>


    <update id="updateBugContent">
        update t_bugcontent set bug_reason=#{bugContent.bugReason},console_error = #{bugContent.consoleError},
        bug_code=#{bugContent.bugCode}
        where bug_contentid = #{bugContent.bugContentId}
    </update>

    <select id="getBugContentList" resultType="cn.com.bugmanager.bugcontent.model.BugContent">
          SELECT  * FROM  t_bugcontent
    </select>

    <delete id="deleteBugContentById" >
          DELETE  from t_bugcontent where bug_contentid=#{bugContentId}
    </delete>

    <select id="getBugContentById"  resultType="cn.com.bugmanager.bugcontent.model.BugContent">
          select * from t_bugcontent where bug_contentid=#{bugContentId}
    </select>

    <select id="getBugContentListPage" resultType="cn.com.bugmanager.bugcontent.model.BugContent">
          select * from t_bugcontent where 1=1
          <if test="bugContent.bugReason != null and bugContent.bugReason != ''">
              AND  bug_reason LIKE  concat('%',#{bugContent.bugReason},'%'),
          </if>
          <if test="bugContent.consoleError != null and bugContent.consoleError != ''">
              AND console_error LIKE concat('%',#{bugContent.consoleError},'%'),
          </if>
          <if test="bugContent.bugCode != null and bugContent.bugCode != ''">
              AND bug_code LIKE concat('%',#{bugContent.bugCode},'%')
        </if>
    </select>
</mapper>